import _extends from"@babel/runtime/helpers/extends";import _defineProperty from"@babel/runtime/helpers/defineProperty";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";import _regeneratorRuntime from"@babel/runtime/regenerator";import _classCallCheck from"@babel/runtime/helpers/classCallCheck";import _createClass from"@babel/runtime/helpers/createClass";import _possibleConstructorReturn from"@babel/runtime/helpers/possibleConstructorReturn";import _getPrototypeOf from"@babel/runtime/helpers/getPrototypeOf";import _inherits from"@babel/runtime/helpers/inherits";var _jsxFileName="/Users/keith/Documents/Projects/node/expo-image-cache/src/Image.tsx";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React from'react';import{View,Image as RNImage,Animated,Platform,StyleSheet}from'react-native';import*as _ from'lodash';import CacheManager from'./CacheManager';var propsToCopy=['borderRadius','borderBottomLeftRadius','borderBottomRightRadius','borderTopLeftRadius','borderTopRightRadius'];var Image=function(_React$Component){_inherits(Image,_React$Component);function Image(){var _getPrototypeOf2;var _this;_classCallCheck(this,Image);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(Image)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.mounted=true;_this.state={uri:undefined,intensity:new Animated.Value(0)};return _this;}_createClass(Image,[{key:"componentDidMount",value:function componentDidMount(){var _this$props=this.props,uri=_this$props.uri,options=_this$props.options;this.load({uri:uri,options:options});}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var _this$props2=this.props,uri=_this$props2.uri,options=_this$props2.options;var prevUri=prevProps.uri;if(uri!==prevUri)this.load({uri:uri,options:options});}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.mounted=false;}},{key:"setVisibility",value:function setVisibility(visible){var transitionDuration=this.props.transitionDuration;var intensity=this.state.intensity;Animated.timing(intensity,{duration:transitionDuration,toValue:visible?100:0,useNativeDriver:Platform.OS==='android'}).start();}},{key:"load",value:function load(_ref){var uri,_ref$options,options,path;return _regeneratorRuntime.async(function load$(_context){while(1){switch(_context.prev=_context.next){case 0:uri=_ref.uri,_ref$options=_ref.options,options=_ref$options===void 0?{}:_ref$options;if(uri){_context.next=3;break;}return _context.abrupt("return");case 3:this.setVisibility(false);_context.next=6;return _regeneratorRuntime.awrap(CacheManager.get(uri,options).getPath());case 6:path=_context.sent;if(this.mounted)this.setState({uri:path});case 8:case"end":return _context.stop();}}},null,this);}},{key:"handleLoadEnd",value:function handleLoadEnd(){var onLoadEnd=this.props.onLoadEnd;if(typeof onLoadEnd==='function')onLoadEnd();this.setVisibility(true);}},{key:"render",value:function render(){var _this2=this;var _this$props3=this.props,style=_this$props3.style,source=_this$props3.source,defaultSource=_this$props3.defaultSource,preview=_this$props3.preview,onLoad=_this$props3.onLoad,onLoadStart=_this$props3.onLoadStart,onLoadEnd=_this$props3.onLoadEnd,otherProps=_objectWithoutProperties(_this$props3,["style","source","defaultSource","preview","onLoad","onLoadStart","onLoadEnd"]);var _this$state=this.state,uri=_this$state.uri,intensity=_this$state.intensity;var isImageReady=!!uri;var flattenedStyle=StyleSheet.flatten(style);var computedStyle=[StyleSheet.absoluteFill,_.transform(_.pickBy(flattenedStyle,function(_val,key){return propsToCopy.includes(key);}),function(result,value,key){return _objectSpread({},result,_defineProperty({},key,value-(flattenedStyle.borderWidth||0)));})];return React.createElement(View,{style:style,__source:{fileName:_jsxFileName,lineNumber:127}},!!defaultSource&&!isImageReady&&React.createElement(RNImage,_extends({style:computedStyle,source:defaultSource},otherProps,{__source:{fileName:_jsxFileName,lineNumber:130}})),!!preview&&React.createElement(RNImage,_extends({style:computedStyle,source:preview,blurRadius:0.5},otherProps,{__source:{fileName:_jsxFileName,lineNumber:138}})),isImageReady&&React.createElement(Animated.Image,_extends({style:[computedStyle,{opacity:intensity.interpolate({inputRange:[0,100],outputRange:[0,1]})}],source:{uri:uri},fadeDuration:0,onLoad:onLoad,onLoadStart:onLoadStart,onLoadEnd:function onLoadEnd(){return _this2.handleLoadEnd();}},otherProps,{__source:{fileName:_jsxFileName,lineNumber:147}})));}}]);return Image;}(React.Component);Image.defaultProps={transitionDuration:300};export default Image;
//# sourceMappingURL=Image.js.map